<div class="vendor_product_item">
  <% new_or_existing = vendor_product_item.new_record? ? 'new' : 'existing' %>
  <% prefix = "sale_order[#{new_or_existing}_vendor_product_item_attributes][]" %>
  <% fields_for prefix, vendor_product_item do |vendor_product_item_form| -%>

    <p>
      <%= vendor_product_item_form.collection_select :purchase_order_item_id, vendor_product_items,
                                                     :id, :vendor_and_title  %>
      <%= vendor_product_item_form.label :unit_price, "Price" %>
      <%= vendor_product_item_form.text_field :unit_price, :size => "4" %>
      <%= vendor_product_item_form.label :quantity, "Quantity" %>
      <%= vendor_product_item_form.text_field :quantity, :size => "1" %>
      <%= link_to_function "remove" , "$(this).up('.vendor_product_item').remove()" %>
    </p>

  <% end -%>
</div>
